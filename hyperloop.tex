\documentclass[heading.tex]{subfiles} 
\begin{document}

\section{Introduction}

Hyperloop is a conceptual transportation system designed to lower costs and travel times relative to California's current high-speed rail project.
\cite{Musk} Elon Musk and a team of engineers from Tesla Motors and the Space Exploration Technologies Corporation (SpaceX)
proposed the idea in August 2013 as an open design to be vetted and further refined through public contribution.
The concept deviates from existing high-speed rail designs by eliminating the rails, enclosing the passenger pod in a 
tube under a partial vacuum, and suspending the pod on air bearings. Propulsion is handled by a set of linear 
electromagnetic accelerators mounted to the tube with the entire system held above ground on concrete 
columns maintaining a relatively straight trajectory.

\begin{figure}[hbtp]
\centering
\includegraphics[width=.75\textwidth]{images/hyperloopAlphaSketch.png}
 \caption[Hyperloop Concept Sketch]{Hyperloop-alpha concept sketch of the passenger pod. \cite{Musk}}
\label{f:hyperloopSketch}
\end{figure}

Although Hyperloop is similar to other vacuum tube train (VacTrain) concepts \cite{ET3},
the soft vacuum represents a distinct difference.
It allows the pod to run on air-bearings, thus removing the need for a magnetic levitation system used on other VacTrain designs.
The air bearings require a source of pressurized air, which is provided by a compressor powered by on-board batteries. 
Since Hyperloop operates at transonic speeds and a low pressure environment, 
the design of the pod compression system can be likened to the compressor design for aircraft turbomachinery.
Furthermore, the aerodynamic concerns arising from constricted flow through a tube
are prevalent in the design of inlets and nozzles on aircraft engines and the entire system faces similar weight and volume constraints. 
For these reasons, the modeling approach applied here is inspired heavily by methods for aircraft sizing and turbine engine cycle analysis. 

Musk's original Hyperloop proposal includes individual high-level analyses of many major subsystems such as the pod compression system,
elevated support structure, and propulsion system. While this demonstrates the basic viability of the concept, it does not address
significant interdisciplinary couplings inherent in the Hyperloop system. These couplings introduce certain constraints that limit the 
degrees of freedom available in the design space. The major contribution of this work is to identify the key couplings that constrain the system
and adapt aircraft sizing methods to construct a conceptual design process that accounts for them. The most significant 
interdisciplinary coupling arises between the passenger pod size and travel tube size. Aerodynamic concerns make it impossible to vary 
both pod size and tube size independently of each other. An additional less severe coupling also exists between the compression system and 
the thermal management system. The interdisciplinary coupling demands the use of an iterative sizing procedure that balances 
the various systems to provide a feasible design for any given set of design variables. The results of this sizing process show that
Hyperloop remains plausible, but certain estimates from the original proposal may have been overly optimistic due to each discipline being approached independently. 

The sizing process is a necessary precursor before ultimately performing a design optimization of 
Hyperloop with the overall objectives such as reducing construction costs, operational costs, and travel time.
Performing this broader optimization 
is outside the scope of this work and is reserved for future investigation. 
The fully integrated system model is constructed using OpenMDAO, a Python-based framework for 
the design and optimization of highly coupled systems\cite{GrayBenchmarking2013}. 
This work focuses on the aerodynamics and thermodynamics of the passenger pod itself.
As such, it ignores many additional key sub-systems that will also have a large impact on the final design.
A more realistic design optimization will require more detailed models of the investigated systems and additional analyses for economic and 
structural models. Adding all of this will result in significant growth in complexity of the Hyperloop model. 
OpenMDAO can provide the means to manage growing model complexity 
in an efficient and flexible manner. Musk's original work was released with the stated goal of jump starting
a crowd sourced design effort. In that spirit, all of the analyses used in this work are released under
the Apache V2.0 open source license so that they can potentially serve as a foundation for future work. 
Links to the source code can be found in \cref{app:Github}

This paper addresses three overarching system challenges related to the passenger pod sizing.
Section \ref{s:struct} describes the overall connectivity of the Hyperloop subsystems. 
Section \ref{s:sizing} clarifies a more stringent coupling between the passenger pod and tube size
and the impact this has on the passenger pod dimensions and performance. 
Section \ref{sec:compressor-and-battery} investigates the compressor and battery requirements for the
proposed Los Angeles to San Francisco route, considering the effects of maximum travel speed. 
Lastly, section \ref{s:heatex} investigates the thermal equilibrium of the
travel tube to provide a means of sizing the thermal management system. 

% \begin{figure}[hbtp]
% \centering
% \includegraphics[width=\textwidth]{images/hyperloop_cad.png}
%  \caption[Hyperloop geometry assembled in OpenCSM]{Calculated baseline inlet (left), nozzle (right), and full assembly (bottom) for a pod speed of Mach 0.8. Geometry rendered in OpenCSM, a parametric solid modeling tool.}
% \label{f:hyperloopCAD}
% \end{figure}


\section{Hyperloop Model Overview}
\label{s:struct}
% A large interdependence between the various Hyperloop subsystems stem
% from design variables dictated by the tube and passenger pod systems.
% This coupling, along with other feedback relationships discussed later, require an
% iterative approach to arrive at a physically valid state for the entire system.

The Hyperloop passenger pod was decomposed into five analyses that were connected to 
form the conceptual sizing model. 

\begin{enumerate}
  \item Compression System: Performance and power consumption of the compressors.
  \item Mission Analysis: Estimate of travel time and velocity profile.
  \item Pod Geometry: Physical dimensions of the passenger pod.
  \item Tube Flow Limitations: Pod speed limitations based on choked flow restrictions.
  \item Tube Wall Temperature: Equilibrium temperature of the tube.
\end{enumerate}

The relationships between the systems are illustrated in Fig. \ref{f:hyperloopXDSM}. 
Feed-forward connections, or variables affecting successive subsystems,
are visualized as the blue arrows in the upper-right side of the diagram.
For example, the \textit{Compressor Cycle} passes data to the \textit{Mission Analysis},
\textit{Pod Geometry}, and \textit{Tube Temperature} analyses.
In the lower-left side of the diagram, red arrows represent feedback connections, which establish cyclical coupling between different analyses.
%The top-left block of Fig. \ref{f:podXDSM} shows system-level design variables that affect numerous components. 
Table \ref{tab:desvars} summarizes the baseline values from the original proposal, which are used as design variables in this analysis.
Notably, both pod radius and travel tube radius are omitted, since these variables cannot be freely varied.
Instead, the assumption of a fixed area for a passenger compartment was made which,
combined with the couplings shown in Fig. \ref{f:hyperloopXDSM}, removed these variables as design inputs.
This issue is discussed in much greater detail in Section~\ref{s:sizing}.

\begin{table}
    \centering
    \caption{Hyperloop passenger pod design variables}
    \label{tab:desvars}
    \begin{tabular}{l  c  c  c} 
        \hline \hline
        Design Variable &  Value\\ \hline \hline
        Max. Pod Mach & 0.9 \\ 
        Pod Bypass Mach & 0.95\\
        Compressor 1 Inlet Mach & 0.6\\ 
        Compressor 1 Pressure Ratio & 12.47\\ 
        Tube Static Pressure (Pa) & 99 \\ \hline
    \end{tabular}
\end{table}

\begin{figure}[hbtp]
\centering
\includegraphics[width=0.65\textwidth]{images/TopAssembly.png}
\caption{Workflow and dependencies between the top-level Hyperloop assemblies.}
\label{f:hyperloopXDSM}
\end{figure}

The compression system and pod geometry analyses are each further subdivided into a number of subsystems. For this work, the pod geometry 
subsystem is primarily responsible for computing physical dimensions using high-level geometric relationships.
 Figure \ref{f:podXDSM} shows the pod geometry breakdown into five further nested subsystems.
This subdivision enhances modularity so that future work can replace these simple analyses with more advanced models
(e.g. structural analyses and weight estimation for the various subsystems).

\begin{figure}[hbtp]
\centering
\includegraphics[width=0.65\textwidth]{images/podAssembly.png}
\caption{Expanded pod geometry assembly}
\label{f:podXDSM}
\end{figure}

The compressor cycle performs calculations related to the thermodynamic processes of compressing, cooling, and exhausting air. 
The modeling approach for the compressor cycle is heavily influenced by
techniques developed for the Numerical Propulsion System Simulation (NPSS) framework. 
NPSS was created as a joint effort between United States engine manufacturers and NASA Glenn Research Center for the purpose of 
simulating and analyzing turbomachinery cycles for aircraft applications\cite{Lytle}. NPSS employs a highly modular model construction
where cycles get broken down into individual thermodynamic processes, which are then subsequently connected together. 
This object-oriented approach was followed for
an open-source adaption of the tool used to predict the fluid properties and power consumption of each component in the cycle. 
%  the air bearings were specified to work with a static pressure of 11 kPa.
As outlined in the original Hyperloop proposal, the compression system is modeled as two separate compressors.
The first compresses the air to bypass the internal structure and passenger compartment
and the second provides an additional pressure rise to reach the necessary air bearing pressure of 11 kPa. 
Subsequently, the required pressure ratio for the second stage is a function of the maximum pod Mach number
and the first stage compressor pressure ratio.
In Fig. \ref{f:compressorXDSM} this relationship manifests as a feedback
connection between the overall performance and second compressor subsystems. 

\begin{figure}[H]
\centering
\includegraphics[width=0.7\textwidth]{images/compAssembly.png}
\caption{Expanded compressor cycle assembly}
\label{f:compressorXDSM}
\end{figure}


\section{Pod and Tube Sizing}
\label{s:sizing}

In the original Hyperloop proposal, the size of the passenger pod and the travel tube are treated as independent design variables, 
free to vary within reasonable ranges of each other. Two different configurations are proposed:
a smaller pod for passengers and a larger pod for both passengers and cargo.
The two configurations had slightly different ratios of tube area to pod area with overall dimensions summarized 
in Table \ref{t:hyperbase}. 

\begin{table}
  \centering
  \caption{Dimensions of the passenger and cargo Hyperloop designs from the original proposal. }
  \label{t:hyperbase}
  \begin{tabular}{l c c}
    \hline
                                  &  Passenger       & Passenger + Cargo \\ \hline
    $r_{tube}$, $m$              &        1.11      &     1.65  \\
    $A_{tube}$, $m^2$           &        3.87      &     8.55  \\
    $A_{pod}$, $m^2$             &        1.4       &     4.0   \\ 
    $A_{bypass}$, $m^2$          &        2.47      &     4.55  \\ 
    $\frac{A_{bypass}}{A_{tube}}$ &        0.64       &     0.53   \\
    Max Mach                      &        0.95       &     0.95   \\
    \hline
  \end{tabular}
\end{table}

\begin{figure}[hbtp]
\centering
\includegraphics[width=.85\textwidth]{images/closedCapsule.png}
\caption{Longitudinal view of a passenger pod with no inlet and no compression system.}
\label{f:ClosedPod}
\end{figure}

Smaller tube sizes are preferable because they provide lower construction costs. However, 
the tube size is coupled to the speed of the air as it passes around a pod of a given size. 
To understand this coupling, consider the following simplified situation: assume that the passenger pod is sealed with a fairing
instead of an inlet. Figure \ref{f:ClosedPod} depicts this situation with the pod
traveling through a frictionless tube from right to left, at some Mach number less than 1, through a stationary mass of air. 
For the purposes of analysis it is more convenient to consider the air speed relative to the pod, 
where the pod is stationary and the air is moving from left to right with some relative Mach number, $M_{pod}$. 
As the air moves around the pod, it must fit into the smaller space available to it, $A_{bypass}$.
This causes the air to accelerate to some higher Mach number, $M_{bypass}$.
From isentropic flow equations, there is a relationship between 
$M_{pod}$ and $M_{bypass}$ that defines an area ratio, $\frac{A_{bypass}}{A_{tube}}$, where $\gamma$ is the heat capacity ratio.

\nomenclature{\gamma}{Heat Capacity Ratio}
\nomenclature{MN}{Mach Number}
\begin{equation}
\frac{A_{bypass}}{A_{tube}} = \frac{M_{pod}}{M_{bypass}}
\left(\frac{1+ \frac{\gamma-1}{2} M_{bypass}^2}
{1+ \frac{\gamma-1}{2} M_{pod}^2}\right)^{\frac{\gamma+1}{2\left(1-\gamma\right)}}
\label{e:a-over-astar}
\end{equation}
%\left(\frac{\gamma+1}{2}\right)^{-\frac{\gamma+1}{2\left(\gamma-1\right)}}\frac{\left(1+\frac{\gamma-1}{2}M_{pod}^{2}\right)^{\frac{\gamma+1}{2\left(\gamma-1\right)}}}{M_{pod}}

\begin{figure}[!htb]
  \centering
  \includegraphics[width=.9\textwidth]{images/areaPlot.pdf}
  \caption{The required area ratio reaches a minimum value at $M_{bypass}=1$ for all values of $M_{pod}$, given the closed pod configuration illustrated in Figure 5.}
  \label{f:choked-flow}
\end{figure}

Figure \ref{f:choked-flow} show the effect of Eq.~(\ref{e:a-over-astar}) over a range of values for $M_{pod}$ and $M_{bypass}$. 
For all values of $M_{pod}$, shown as a family of curves, the minimum required $\frac{A_{bypass}}{A_{tube}}$ occurs exactly at $M_{bypass}=1$.
In other words, 
$M_{bypass}=1$ will always give the smallest possible $A_{bypass}$ (and hence $A_{tube}$) for a given 
$M_{pod}$ and $A_{pod}$. Thus $A_{tube}$ cannot be treated as an independent design variable without over-constraining the problem.
If $A_{tube}$ is forced to be smaller than this minimum value, not all the relative mass flow can pass freely around the pod. This excess 
flow would accumulate to the left of the pod in Fig. \ref{f:ClosedPod},
with the pod acting like a piston: pressurizing the air in front of it. 

Furthermore, Fig. \ref{f:choked-flow} also shows that $\frac{A_{bypass}}{A_{tube}}$ 
increases with increasing $M_{pod}$. So the faster the pod travels, the larger $A_{bypass}$ 
must become relative to the tube area, leaving less area for the pod. For $M_{pod} = 1$ , $\frac{A_{bypass}}{A_{tube}}$ must 
equal 1 as well, forcing $A_{pod}$ to be 0. Note that the values from Table \ref{t:hyperbase} translate to area ratios around 0.6, 
which yields a much lower maximum pod speed of about Mach 0.3-0.4 for a pod without an inlet and compression system. 

\begin{figure}[hbtp]
\centering
\includegraphics[width=.85\textwidth]{images/hollowCapsule.png}
\caption{Longitudinal view of a hollow passenger pod that lets mass flow pass through it.}
\label{f:hollowPod}
\end{figure}

To get around this limitation, Hyperloop allows some mass flow to pass through the pod itself, thereby increasing
the maximum achievable speed. This effectively splits the relative mass flow in $A_{tube}$ into two streams, 
$A_{tube\ B}$ and  $A_{tube\ C}$, as shown in Fig. \ref{f:hollowPod}. If we neglect the small thickness of the walls of
the passenger pod itself and assume that $A_{tube\ C}$ is equal to the $A_{pod}$, then it follows that $A_{tube\ B}$ 
will be equal to $A_{bypass}$. Without any area contraction the flow in the bypass will not accelerate, staying 
equal to $M_{pod}$. The challenge is that the pod cannot be perfectly hollow. It must provide some space for the passengers
to sit, causing blockage in the flow. This problem can be handled by adding a compression system to the 
pod that will force the air into a smaller area $A_{compressed}$, to move around the passengers. This would 
seem to solve all of the challenges associated with high travel speeds inside a tube discussed above and decouple 
$\frac{A_{bypass}}{A_{tube}}$ and ${M_{pod}}$.


\begin{figure}[hbtp]
\centering
\includegraphics[width=0.85\textwidth]{images/openCapsule.png}
\caption{Longitudinal view of a hollow passenger pod with a necessary diffuser to restrict the Mach number of the flow into the compressor.}
\label{f:OpenPod}
\end{figure}

However, in order to achieve reasonable efficiency from the compression system, the Mach number of the flow at the compressor face
must be limited to less than about 0.65. For $M_{pod}$ greater than 0.65, a diffuser must be added to the Hyperloop 
which will slow the air down before it enters the compressor. As depicted in Fig. \ref{f:OpenPod}, diffusing the flow 
requires expanding the area; $A_{diffused}$ must be greater than $A_{tube,c}$. Unfortunately this means that
$A_{bypass}$ must be smaller than $A_{tube\ B}$, and some acceleration of the flow around the pod will occur.
Once again, $\frac{A_{bypass}}{A_{tube}}$ becomes coupled to $M_{pod}$, although thanks to the compression 
system this is now much less restrictive than if the pod is sealed. 

Figure \ref{f:machRAD} shows the rise in achievable pod Mach number based on increasing amount of hollowness.
This increase is dependent on the amount of space taken up by the pod outer structure,
which is a ratio of dimensions shown in Fig. \ref{f:OpenPod}
as a non-dimensional ``blockage factor'' equal to $\frac{A_{diffused}}{A_{pod}}$.
The higher the factor, the lower the blockage from the pod.
For a nominal tube diameter of 4 meters, the maximum pod Mach increases from 0.66 for a closed pod (not shown)
to 0.82 for a hollow pod with a blockage factor of 0.9.
To a lesser extent, the max speed is also dependent on the compressor entrance Mach number.
Changing the allowable compressor entrance Mach number by $\pm 0.05$ changes the maximum pod MN by roughly $\pm 0.01$. 
Modifying the blockage factor by $\pm 0.05$ changes the maximum pod MN by roughly $\pm 0.03$.
It should be noted that all of these trends are unaffected by the tube pressure,
however, static pressure affects the compressor flow and power requirements discussed next.


\nomenclature{c1MN}{Mach number at the front face of the first compressor}
\nomenclature{BF}{Blockage Factor, diffused area over pod area}
\begin{figure}[H]
\centering
\includegraphics[width=0.8\textwidth]{images/mach_vs_rad6.png}
\caption[Tube and Pod Radius vs Mach]{Exponential relationship between pod speed and required tube diameter, for three blockage factors $\frac{A_{diffused}}{A_{pod}}$.}
\label{f:machRAD}
\end{figure}


\section{Compressor Power and Battery Sizing}
\label{sec:compressor-and-battery}

The on-board compression system serves three purposes.
It provides a means of increasing the maximum pod speed over a closed pod, supplies pressurized air to the air bearing system,
and provides a small amount of thrust.
The second function requires a minimum airflow to provide the fluid pressure necessary to support the vehicle weight.
A thermodynamic analysis of the compressor system is also necessary to
estimate on-board power requirements and overall heat rise of each pod.
The compression cycle is comprised of an inlet, two compressors, a nozzle, and multiple ducts leading to air bearings.
The design deviates from the original proposal by removing two heat exchangers for reasons explained in section \ref{s:heatex}.
The system, shown previously in Fig. \ref{f:compressorXDSM}, is modeled as a one-dimensional cycle,
representing components as thermodynamic processes that are subsequently chained together.
Each component is responsible for calculating gas properties across its boundaries
and appropriately enforcing conservation equations across the entire system.

%\begin{figure}[hbtp]
%\centering
%\includegraphics[width=0.9\textwidth]{images/compressor_schematic.png}
%\caption{Schematic of the Hyperloop compression system, showing flow connections between components.}
%\label{f:comp}
%\end{figure}
This tool, later named ``PyCycle'', was built within the openMDAO framework and leverages Cantera
\cite{goodwin2009cantera} for thermodynamic calculations.
The model predicts the instantaneous power consumption of the compressors, temperature and pressure rises,
and upstream conditions necessary to supply sufficient airflow to the bearings.
These power requirements are a function of the chosen geometry, creating the feedback loop “B” in Fig. \ref{f:hyperloopXDSM}.
Combined with the mission profile described below, these requirements impact battery sizing.

\begin{figure}[hbtp]
\centering
\includegraphics[width=0.7\textwidth]{images/velocity_profile3.png}
\caption{Velocity profile described in the original proposal, with the programmatically modified section highlighted in red.}
\label{f:velocity}
\end{figure}

The notional velocity profile described in the original proposal, shown by the solid line in Fig. \ref{f:velocity},
is programmatically modified based on the recomputed maximum velocity of the pod. The starting and final velocities of the
mission profile are dictated by maximum allowable acceleration loads, while the highest plateau is governed by the
choked flow limit. Therefore, the fastest portion of the trip, illustrated in red, is modified as the simulation runs and re-computes pod speed.
Reducing the maximum speed also increases the total mission time,
pushing the final mission segment out further as shown by the dashed lines.
The integrated area under the curve represents the total length of the tube, which remains constant as the max speed varies.
The speed constraints outlined earlier increase total mission time on the order of five minutes,
however this will ultimately depend on the chosen tube diameter.
Despite the increased mission time, the slower speeds would also allow for more forgiving acceleration loads around turns.
Multiplying the calculated mission time by the maximum instantaneous compressor power consumption (plus a 30\% safety margin)
results in an overall battery storage requirement.

\begin{figure}[hbtp]
\centering
\includegraphics[width=0.9\textwidth]{images/battery_plot.pdf}
\caption[Battery/Compressor/Mission requirements as a function of pod speed]
{Battery requirements, compressor power, and mission time as a function of pod speed.}
\label{f:battery}
\end{figure}

The necessary on-board battery energy was found to be negatively correlated to the max pod speed,
as shown by the green curve in Fig. \ref{f:battery}.
The maximum instantaneous compressor requirements and total mission time
are also directly overlaid in red and blue respectively. 
The negative slope of the green battery curve indicates that total mission time falls
faster than the compressor power requirements increase.
Although traveling at higher speeds draws more energy, the system is operated for a shorter period of time.
At higher travel speeds, the total battery requirements start to flatten and the trend starts to reverse.
The units are scaled such that the slopes of each curve can be more easily related to each other spatially.
% By drawing a horizontal and tangent line on each of the power and time slopes at a given speed,
% if the two subsequent angles were perfectly inverted, the battery curve would have a zero slope at that speed.
The overall reduction in battery size is on the order of 7\%, if the speed is increased from Mach 0.7 to Mach 0.9, 
however the analysis only considers the on-board energy requirements. It does not consider the increased power
necessary for the linear accelerators to drive the pod to higher speeds. 
Furthermore, the battery trend is highly dependent on the velocity profile
and reducing time spent at max speed could result in a positive correlation between battery size and pod speed.
Additional route analyses can be found in work done by Mathworks \cite{Rouleau}.
These estimated energy requirements are in agreement with Musk's work,
and equate to roughly 4 battery packs from a Tesla Model-S.
Notably, these estimates do not include considerations for battery cooling requirements or auxiliary power,
and are based on the assertion that the compression cycle does not need to be cooled.
The system-level thermal interactions and heat exchangers are analyzed next.

\section{Heat Exchanger and Tube Thermal Analysis}
\label{s:heatex}
As each pod passes through the tube, it adds energy to the air in the form of heat.
Following the proposed frequency of launching a pod every six minutes,
the continuous operating cycle could potentially heat the overall tube to excessive temperatures.
To combat this effect, the original proposal recommends a heat exchanger that would be integrated into the compression system.
These intercoolers would use water stored in on-board tanks to cool the air and assist secondary compression.
The resulting steam could then be stored in a tank and offloaded once the pod reached its destination.
However, initial calculations show that using water for cooling is not an ideal design for two reasons:

1) The flow rate of water needed to remove the heat added by the compressors is very large,
and the sheer volume constraints of storing the resulting steam would outweigh the benefits.

2) The heat addition from each pod compressor cycle is fairly low relative to other heat transfer mechanisms
occurring between the Hyperloop tube and the external environment.
Even without an active on-board cooling solution, the tube temperature would be dominated by other factors.

The following two sections provide additional details about the engineering models used to draw these conclusions.

\subsubsection{Pod Cooling Requirements}

The limits and requirements of a hypothetical on-board heat exchanger can be estimated with a straightforward energy balance. The
effectiveness of a heat exchanger can be described as the ratio of actual heat transfer over the maximum possible heat transfer.

\nomenclature{Q}{Heat flow rate (W)}
\begin{equation}
{Q}_{released}  = effectiveness \cdot \underbrace{\left(T_{hot,in} - T_{cold,in}\right) [ \dot{m} C_{p} ]_{fluid}}_\text{${Q}_{max}$}
\end{equation}


where ${Q}_{max}$ is determined by the fluid with the lowest $\dot{m} C_{p}$ product, which dictates the maximum possible heat transfer.
In order to satisfy the energy balance $Q_{released}=Q_{absorbed}$ the following must be true,

\nomenclature{\dot{m}}{Mass flow rate}
\nomenclature{T}{Temperature (K)}
\nomenclature{C_{p}}{Heat capacity at constant pressure ($\frac{J}{kg-K}$) }
\begin{equation}
\underbrace{\dot{m}_{air} C_{p, air} (T_{out, air} - T_{in, air})}_{{Q}_{released}}  = \underbrace{\dot{m}_{water} C_{p,water} (T_{out, water} - T_{in, water})}_{{Q}_{absorbed}}
\end{equation}

where the $T_{out}$  of each fluid is unknown. With assumed mass-flow rates and initial temperatures, a valid combination of $T_{out}$'s of
each fluid can be found through solver iteration. Valid effectiveness levels for heat exchangers can be estimated based on the
Effectiveness - Number of Transfer Units (NTU) method. 
The effectiveness for a counter flow heat exchanger with a $\frac{C_{p,min}}{C_{p,max}}$ of ~0.25 was chosen with air and water as the working fluids. 
The following conditions satisfied an energy balance with an extremely optimistically assumed effectiveness of 0.9765,
and the proposed requirement to fully cool the air back down to inlet temperatures.

\nomenclature{NTU}{Number of Transfer Units}

\begin{table}
    \centering
    \caption{Heat Exchanger Fluid Properties}
    \label{tab:HeatEx}
    \begin{tabular}{l  c  c  c  c  c  c} 
        \hline
        Fluid & $C_{p}$ ($\frac{kJ}{kg-K}$)& $T_{in}$ (K) & $T_{out}$ (K) & $\dot{m}$ ($\frac{kg}{s}$) & Q ($\frac{kJ}{s}$) & $Q_{max}$\\ \hline 
        Air & 1.006 & 791 & 300 & 0.49 & -242 & 247.9\\ 
        Water & 4.186 & 288.15 & 416.6 &0.45 & 242 & 247.9\\ \hline
    \end{tabular}
\end{table}

With a 35 minute trip, $0.45 \frac{kg}{s} \cdot 60 \frac{s}{min} \cdot 35min = 945 kg$
of standard temperature/pressure water would need to be carried.
Beyond weight concerns, the density of saturated steam at the given temperatures is on the order of 1-2$\frac{kg}{m^{3}}$
meaning that the resulting volume necessary for 2-4 atm
steam tanks would be impractical given a cross-section smaller than 8$m^{2}$.
Depending on the tank temperature and pressure conditions, these tanks could exceed a hundred meters in length.
This doesn't even account for the second stage heat exchanger,
making the system nearly infeasible with water and unpressurized tanks.
Various systems involving partial cooling, alternate coolants (such as liquid air), or pressurized tanks could be explored.

Further discussion of heat exchanger sizing can be found in the heat exchanger section of \cref{app:heatX}.
The calculations explore the possibility of multi-pass heat exchangers
and the logarithmic mean temperature difference of the heat exchanger is considered.
\cite{Cengal}\textsuperscript{,}
\cite{Turns}


\subsubsection{Equilibrium Tube Temperature}

The onboard water cooling and vapor collection system as proposed in Ref. \citen{Musk}
appears infeasible for reasons described above.
Nevertheless some form of pod cabin cooling would be desired. 
If the tube temperature is not excessive,
pod occupants could be kept comfortable with a relatively simple cabin air conditioning system.
Cabin heat could be rejected from the refrigerant to the tube environs via conventional heat
exchangers.

A simple quasi-steady equilibrium heat balance
is performed to determine the approximate tube temperature.
The analysis ignores heat transfer time lags and diurnal cycles.
Heat is assumed to transfer and equilibrate rapidly between the pod compressor system,
the rarified atmosphere inside the tube, the tube walls, and the outside environment.
Further investigation is needed to determine the validity of this assumption.
What in the real world would be a complex heat transfer problem
is modeled here simplistically.
This assessment is intended to estimate a conservative
equilibrium tube temperature at full sun during the maximum heat of the day.
An analysis of this level of fidelity is hoped to be sufficient to determine if a
simple cabin air conditioning system could manage pod heating.

If the heat of the rarified atmosphere inside the tube exchanges rapidly with the tube wall,
then the total temperature of the air entering the compressor inlet
may be related to the tube wall temperature ($T_{tube}$) and the pod Mach number ($M$):

\nomenclature{P}{Pressure ($\frac{N}{m^{2}}$)}
\nomenclature{PR}{Pressure Ratio}
\nomenclature{PR}{Pressure Ratio}
\nomenclature{{\eta}_{ad}}{Adiabatic Efficiency}
\begin{equation}
T_{t,inlet} = T_{tube} [1 + \frac{\gamma -1}{2} M^2]
\end{equation}

Using additional isentropic relationships,
the total temperature of the air exiting the pod nozzles may be written as a function
of the compressor's pressure ratio ($\pi_{c}$) and adiabatic efficiency ($\eta_{c}$):

\begin{equation}
T_{t,exit} = T_{t,inlet} \Bigg[ 1 + \frac{1}{\eta_{c}} \Big[ \pi_{c}^{\frac{\gamma-1}{\gamma}}- 1 \Big] \Bigg]
\end{equation}

The heating rate due to all of the pods operating in the tube may be estimated by

\begin{equation}
{Q}_{pods}= \dot{m} C_{p,air} (T_{t,exit} - T_{t,inlet}) n
\end{equation}

where $n$ is the number of pods in transit,
$\dot{m}$ is the airflow per compressor determined by the cycle analysis,
and $C_{p,air}$ is the specific heat of air given by the relations in Ref. \citen{Clausing}. 

The entire 300 mile length of the tube is assumed to be unshaded and exposed to sunlight.
Only direct solar irradiance ($G$) is considered.
At noon on a clear day at ground level, $G$ may be as great as 1000 $\frac{W}{m^{2}}$,
although it may be substantially attenuated on cloudy days.
The heating rate due to solar irradiation is estimated by

\begin{equation}
Q_{solar} = \underbrace{ (1- \rho_{r})  c_{solar}G}_\text{Solar Heat per unit Area} \underbrace{L_{tube}  D_{o,tube}}_\text{Effective Area}
\end{equation}

\nomenclature{\rho}{Total, Hemispherical Reflectivity}
\nomenclature{G}{Solar Irradiance}
\nomenclature{c_{solar}}{Gross Irradiance Adjustment}
\nomenclature{L}{Length (m)}
\nomenclature{\epsilon}{Emissivity Factor}
\nomenclature{\sigma}{Stefan-Boltzmann constant ($\frac{W}{m-K}$)}
\nomenclature{P_{rad}}{Radiated Power (W)}

where $\rho_{r}$ is the total, hemispherical reflectivity of the tube's exterior surface,
$L_{tube}$ is the length of the tube, and $D_{o,tube}$ its outer diameter.
$c_{solar}$ is a gross adjustment factor intended to account for diffuse
scattered irradiance (causing $c_{solar}$ to increase), as well as shaded regions,
non-normal incidence and other geometric peculiarities (causing $c_{solar}$ to decrease).
Added together,
$Q_{pods}$ and $Q_{solar}$ represent the incoming heating rate on the tube.
At this point an interesting observation may be made.
Using representative values for each of the system parameters,
it is estimated that the heat generated by the pods in transit
amounts to a small fraction of the total heating rate.
Insolation appears responsible for more than 95\% of tube heating.
The impact of solar heating, of course, may be abated by coating
or shading the tube's steel surface with a highly reflective and emissive material.

On the other side of the thermal balance,
radiation and convection heat transfer from the tube are assumed
to be the primary heat loss mechanisms. The radiative heat transfer is estimated by

\begin{equation}
Q_{rad} = \underbrace{\epsilon \sigma (T_{tube}^4 - T_{amb}^4)}_\text{Radiated Power per unit Area}\underbrace{\pi L_{tube} D_{o,tube}}_\text{Surface Area}
\end{equation}

where $\epsilon$ is the total, hemispherical emissivity of the tube's exterior surface,
$\sigma$ is the Stefan-Boltzmann constant, and $T_{amb}$ is the ambient temperature.
The heat transfer surface is assumed to be gray,
and the surroundings are assumed to be isothermal and black.
Convection heat transfer from the tube to the surroundings is estimated using a
correlation of the Nusselt number: \cite{Churchill}
(Nu, defined as $\frac{hD_{o,tube}}{k}$)


\nomenclature{g}{Acceleration of gravity, 9.81 ($\frac{m}{s^{2}}$)}
\nomenclature{\beta}{Volume coefficient of expansion (K)}
\nomenclature{\upsilon}{Kinematic Viscosity ($\frac{m^{2}}{s}$)}
\nomenclature{Pr}{Prandtl Number, $\frac{\upsilon}{\alpha}$}
\nomenclature{Gr}{Grashof Number, $\frac{ g \beta \delta TL^{3}}{v^{2}}$}
\nomenclature{Ra}{Rayleigh Number, $\frac{\rho U_{\infty} L}{\mu}$}
\nomenclature{Nu}{Nusselt Number, $\frac{hL}{k}$}
\nomenclature{h}{Heat transfer coefficient ($\frac{W}{m^{2}-K}$)}
\nomenclature{k}{Thermal Conductivity ($\frac{W}{m-K}$) }

\begin{equation}
Nu = \Bigg(0.6 + \frac{0.387Ra^{\frac{1}{6}}}{[1+(\frac{0.559}{Pr})^{\frac{9}{16}}]^{\frac{8}{27}}}\Bigg)^2
\end{equation}

where $Ra$ is the Rayleigh number
($\frac{g \beta} {\upsilon\alpha}  [T_{tube}-T_{amb}] {D}_{o,tube}^3$)
and Pr is the Prandtl number ($\frac{\nu}{\alpha}$).
The correlation is applicable for estimating free convection from long,
horizontal cylinders. Properties for air ($h$, $k$, $\beta$, $\nu$ and $\alpha$)
are based on the film temperature of the thermal boundary layer
and are given by the regressions in Ref. \citen{Clausing}.
With the heat transfer coefficient $h$ known from the Nusselt number,
the heat lost to free convection ($Q_{conv}$) may be estimated from the total tube surface area.

\begin{equation}
Q_{conv} = \underbrace{ \frac{k\cdot Nu}{ {D}_{o,tube}} }_\text{$h$}
 \underbrace{ \pi {L}_{tube} {D}_{o,tube} }_\text{Area} 
 \underbrace{ (T_{tube}-T_{amb})  }_\text{$\Delta T$} 
\end{equation}


The equilibrium tube temperature is determined by varying $T_{tube}$ until the criterion
$Q_{pods} + Q_{solar} = Q_{rad} + Q_{conv}$ is satisfied.
Estimating a single deterministic tube temperature, however, is insufficient.
The parameters of the problem have a strong influence over the resulting equilibrium
temperature. For example, ambient temperature will vary substantially.
A breeze can amplify convection rates by a factor of two or three,
and furthermore,
it is not clear what surface properties the tube may have.
For these kinds of reasons, several parameters in the problem are set to vary in 
a Monte Carlo probability experiment.
The deterministic tube temperature model above is transformed into a stochastic model by
replacing portions of its input with continuous random values.
The random values are derived from probability distributions
around the model's nominal values as listed in Table \ref{tab:montecarlo}.

\begin{table}[hbtp]

    \centering
    \caption{Uncertainty variables used in the Monte Carlo experiment.}
    \label{tab:montecarlo}
    \begin{tabulary}{1.0\textwidth}{l  c  c  c c c} 
        \hline
        Variable & Mode & Model & Min & Max & Std. Dev\\ \hline \hline
        $T_{amb}$ & 305 K & Normal & - & - & 4.5 K \\ 
        $G$ & $1000\frac{W}{m^{2}}$ & Triangular & $200\frac{W}{m^{2}}$ & $1000\frac{W}{m^{2}}$ & - \\
        $\rho$ & 0.5 & Triangular & 0.4 & 0.9 & - \\
        $\epsilon$ & 0.5 & Triangular & 0.4 & 0.9 & - \\
        $\eta_{c}$ & 0.69 & Triangular & 0.6 & 0.8 & - \\
        $n$ & 34 & Triangular & - & - & 2 \\
        $c_{solar}$ & 0.7 & Triangular & 0.5 & 1.0 & - \\
        $c_{conv}$ & 1.0 & Triangular & 0.9 & 3.0 & - \\
        \hline
    \end{tabulary}
    
\end{table}


A histogram and a normal distribution of tube temperature
based on 15,000 samples are shown in Fig. \ref{f:montecarlo}.
The mean tube temperature is 108 \degree F with a standard deviation of 11 \degree F.
Exceeding 137 \degree F only occurs in 0.5\% of the possible scenarios generated.
This Monte Carlo assumes a fixed tube diameter of 4 meters,
for reasons outlined in Section \ref{s:sizing}.
Repeating the experiment closer to the original 2 meter diameter results in
a distribution with approximately the same mean and a lower standard deviation
of 9.7 \degree F.

\begin{figure}[hbtp]
\centering
\includegraphics[width=.9\textwidth]{images/histo.pdf}
 \caption[MonteCarlo]{Monte Carlo uncertainty analysis of the equilibrium tube temperature.
 Histograms and normal distribution generated from 15,000 samples
 using a bin span of 1\degree F.}
\label{f:montecarlo}
\end{figure}


The sub-iteration of the thermal discipline then feeds back into the overall
Hyperloop convergence loop, both affected by and contributing to the
compression cycle, creating feedback “C” in Fig. \ref{f:hyperloopXDSM}.
The analysis suggests that the dominant heating factors are a direct result of
the massive tube structure, with only 5\% of the heat contributed from the pods.
The thermal management should therefore be incorporated into the tube design,
rather than integrated into the volume and weight constrained pod design.
Considerations for solar panel shielding as outlined in the original proposal
would produce even more thermally optimistic results.


\section{Conclusions}

Using openMDAO and pyCycle, a publicly extensible model of the Hyperloop concept was created 
to investigate the features and assertions of the original design. 
The refined analysis illuminates several
interdisciplinary couplings that alter two major aspects of the initial concept.
First, the pod travel speed and the tube cross sectional area are linked, forcing 
the tube size to be to be roughly twice the diameter of the original specification,
in order for the pod to reach Mach 0.8.
Second, the steady-state tube temperature is dominated by ambient thermal interactions
unrelated to the heat generated by the pod compression system. As a result,
the two water-based heat exchangers originally prescribed for thermal management are eliminated.
Although this work identifies some necessary refinements to the Hyperloop design, the core 
concept remains potentially feasible and warrants continued investigation. 
This work emphasizes the importance of maintaining a systems-level approach
and provides toolsets capable of managing the growing complexity.
The modeling platform is intended to serve as an easily accessible baseline that is straightforward to
expand and delve deeper into this unique multidisciplinary endeavor.

\end{document}
